---
- import:   pyresttest_demo.yaml

-   config:
    -   testset:    "pyresttest generator poc"
    -   generators:
        - 'wigenerated': {type:  'number_sequence',  start:  1}
    -   variable_binds: {
          'headername': 'Content-Type',
          'headervalue':  'application/json',
          'fixedspacename':  'testspaceruch1',
          'witypeexperience':   '26787039-b68f-4e28-8814-c2f93be1ef4e',
          }

-   test:
    -   name:   "Find a Space -generator poc-"
    -   url:    {'template':  "/api/search/spaces?q=$fixedspacename"}
    -   headers:  {template:  {'$headername': '$headervalue', 'Authorization':  'Bearer $token'}}
    -   expected_status:    [200]
    -   extract_binds:
        -   'spaceid': {'jsonpath_mini': 'data.0.id'}

-   benchmark: # create 20 WIs
    -   generator_binds:    {wigenerated: wigenerated}
    -   name:   "Create autogenerated WorkItems -generator poc-"
    -   url:  {'template':  "/api/spaces/$spaceid/workitems"}
    -   warmup_runs:    0
    -   method: 'POST'
    -   headers:    {template:  {'$headername': '$headervalue', 'Authorization':  'Bearer $token'}}
    -   body:   {template:  '{"data":{"attributes":{"system.state":"new","system.title":"$wigenerated","system.description":"$wigenerated"},"relationships":{"baseType":{"data":{"id":"$witypeexperience","type":"workitemtypes"}}},"type":"workitems"}}'}
    -   benchmark_runs: 10
    -   metrics:
        -   total_time: total
        -   total_time: mean

# -   test:
#     -   name:   "Delete the Space as we are DONE" 
#     -   url:    {'template':  "/api/spaces/$spaceid"}
#     -   method: "DELETE"
#     -   headers:  {template:  {'$headername': '$headervalue', 'Authorization':  'Bearer $token'}}
#     -   expected_status:    [200]
